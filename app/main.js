(()=>{"use strict";var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=require("fs"),t=require("path"),n=require("http");const r=n.createServer(((e,n)=>{return r=void 0,a=void 0,u=function*(){const r=t.resolve(t.dirname(""))+("/"===e.url?"/front/index.html":"/front"+e.url);o.readFile(r,(function(e,o){if(e)return n.writeHead(404),void n.end(JSON.stringify(e));n.writeHead(200),n.end(o)}))},new((i=void 0)||(i=Promise))((function(e,o){function t(e){try{c(u.next(e))}catch(e){o(e)}}function n(e){try{c(u.throw(e))}catch(e){o(e)}}function c(o){var r;o.done?e(o.value):(r=o.value,r instanceof i?r:new i((function(e){e(r)}))).then(t,n)}c((u=u.apply(r,a||[])).next())}));var r,a,i,u})),a=require("robotjs");var i=e.n(a);const u=require("ws");var c=e.n(u);const s=require("jimp");var m=e.n(s),d=function(e,o,t,n){return new(t||(t=Promise))((function(r,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function u(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var o;e.done?r(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(i,u)}c((n=n.apply(e,o||[])).next())}))};console.log("Start static http server on the 3000 port!"),r.listen(3e3),new u.WebSocketServer({port:8080}).on("connection",(e=>d(void 0,void 0,void 0,(function*(){console.log("New client connected");const o=c().createWebSocketStream(e,{decodeStrings:!1});o.on("data",(e=>d(void 0,void 0,void 0,(function*(){console.log(`Client has sent us: ${e}`);const t=e.toString(),n=i().getMousePos(),r=t.split(" ");let a,u=r[0];switch(a=r.length>2?{x:r[1],y:r[2]}:r.length>1?r[1]:null,u){case"mouse_up":((e,o)=>{i().moveMouse(e.x,e.y-Number(o))})(n,a);break;case"mouse_down":((e,o)=>{i().moveMouse(e.x,e.y+Number(o))})(n,a);break;case"mouse_left":((e,o)=>{i().moveMouse(e.x-Number(o),e.y)})(n,a);break;case"mouse_right":((e,o)=>{i().moveMouse(e.x+Number(o),e.y)})(n,a);break;case"mouse_position":u+=` ${n.x},${n.y}`;break;case"draw_circle":((e,o)=>{i().mouseToggle("down");const t=2*Math.PI/500,n=Number(o);for(let o=-Math.PI;o<=Math.PI;o+=t){const t=Math.round(n*Math.cos(o)),r=Math.round(n*Math.sin(o));i().dragMouse(e.x+t+n,e.y+r)}i().mouseToggle("up")})(n,a);break;case"draw_rectangle":((e,o)=>{if("object"==typeof o){i().mouseToggle("down");const t=null==o?void 0:o.x,n=null==o?void 0:o.y;i().moveMouseSmooth(e.x+Number(t),e.y),i().moveMouseSmooth(e.x+Number(t),e.y+Number(n)),i().moveMouseSmooth(e.x,e.y+Number(n)),i().moveMouseSmooth(e.x,e.y),i().mouseToggle("up")}})(n,a);break;case"draw_square":((e,o)=>{i().mouseToggle("down"),i().moveMouseSmooth(e.x+Number(o),e.y),i().moveMouseSmooth(e.x+Number(o),e.y+Number(o)),i().moveMouseSmooth(e.x,e.y+Number(o)),i().moveMouseSmooth(e.x,e.y),i().mouseToggle("up")})(n,a);break;case"prnt_scrn":const e=yield(e=>{return o=void 0,t=void 0,r=function*(){const o=200,t=100,n=i().getScreenSize();let r,a;r=e.x+t>n.width?n.width-o:e.x<t?0:e.x-t,a=e.y+t>n.height?n.height-o:e.y<t?0:e.y-t;const u=i().screen.capture(r,a,o,o),c=new(m())(o,o);return c.bitmap.data=u.image,c.scan(0,0,c.bitmap.width,c.bitmap.height,((e,o,t)=>{const n=c.bitmap.data[t+0],r=c.bitmap.data[t+2];c.bitmap.data[t+0]=r,c.bitmap.data[t+2]=n})),yield c.getBase64Async(m().MIME_PNG)},new((n=void 0)||(n=Promise))((function(e,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function u(e){try{c(r.throw(e))}catch(e){a(e)}}function c(o){var t;o.done?e(o.value):(t=o.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}c((r=r.apply(o,t||[])).next())}));var o,t,n,r})(n);u+=` ${e.slice(22)}`}o.write(u)})))),e.on("close",(()=>{console.log("Client has disconnected")}))}))))})();